---
title: "Zi-Frühindikatoren zu COVID-19"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll 
    logo: static/logo.png
    theme: bootstrap
    css: static/styles.css
    
    
---

```{r setup, include=FALSE}
library(flexdashboard)
source("R/functions.R", encoding = "UTF-8")
```

# Dashboard 

Row {data-height=125}
------------------------------------------------------------------------

### **Zi-Frühindikatoren:** 

Das Zi hat Frühindikatoren entwickelt, die frühzeitig auf die Gefahr für die Überlastung des Gesundheitswesens durch COVID-19 hinweisen sollen. Nachfolgend wird unsere tägliche Lageeinschätzung im Hinblick auf diese Indikatoren dargestellt. **Nähere Informationen finden Sie [hier](https://www.zi.de/fileadmin/images/content/PMs/Fruehindikator_fuer_ein_Management_des_Pandemiegeschehens_2020-08-03.pdf)**. 

Stand: `r format(now(),format="%d.%m.%Y %H.%M Uhr")`

Row 
------------------------------------------------------------------------

### Reproduktionszahl 

```{r}
indicatorR <- aktuell %>% filter(id==0) %>% collect() %>% pull(R0)
valueBox(value= paste("R =",format(indicatorR,digits=2,decimal.mark = ","))  ,
         caption="Reproduktionszahl",
         color = case_when(indicatorR < 1.0 ~ "#B1C800",
                           indicatorR >= 1.0 & 
                             indicatorR < 1.3 ~ "#E49900",
                           indicatorR >= 1.3 ~ "#E40000"),
         icon = "fa-users"
        )
```

Row 
------------------------------------------------------------------------

### Neue Fälle je 100.000 Einwohnende in 7 Tagen

```{r}
faelleprotag <-  vorwarnzeitergebnis %>% filter(id==0) %>% pull(Faelle_letzte_7_Tage_pro_Tag)
faelle7tage100kEW <-  vorwarnzeitergebnis %>% filter(id==0) %>% pull(Faelle_letzte_7_Tage_je100TsdEinw)
valueBox(faelle7tage100kEW,
         caption="Neue Fälle je 100.000 Einwohnende in 7 Tagen",
         icon = "fa-chart-line",
         color = case_when(faelle7tage100kEW < 35 ~ "#B1C800",
                           faelle7tage100kEW >= 35 & 
                             faelle7tage100kEW < 50 ~ "#E49900",
                           faelle7tage100kEW >= 50 ~ "#E40000")
        )
```

<!-- Row  -->
<!-- ------------------------------------------------------------------------ -->
<!-- ### Neue Fälle pro Tag (7-Tages-Mittelwert)  -->

<!-- ```{r} -->
<!-- faelleprotag <-  vorwarnzeitergebnis %>% filter(id==0) %>% pull(Faelle_letzte_7_Tage_pro_Tag) -->
<!-- gesundheitsamtzahl <- 380 -->
<!-- valueBox(faelleprotag, -->
<!--          caption="Neue Fälle pro Tag (7-Tages-Durchschnitt)", -->
<!--          icon = "fa-chart-line", -->
<!--          color = case_when(faelleprotag < gesundheitsamtzahl*3 ~ "#B1C800", -->
<!--                            faelleprotag >= gesundheitsamtzahl*3 &  -->
<!--                              faelleprotag < gesundheitsamtzahl*4 ~ "#E49900", -->
<!--                            faelleprotag >= gesundheitsamtzahl*4 ~ "#E40000") -->
<!--         ) -->
<!-- ``` -->

Row 
------------------------------------------------------------------------

### Vorwarnzeit bei R=1,3 

```{r}
vorwarnzeitaktuell <- vorwarnzeitergebnis %>% filter(id==0) %>% pull(Vorwarnzeit_effektiv)
valueBox(paste(vorwarnzeitaktuell,"Tage"),
         caption="Effektive Vorwarnzeit bei R=1,3",
         icon = "fa-calendar-alt",
         color = case_when(vorwarnzeitaktuell > 60 ~ "#B1C800",
                           vorwarnzeitaktuell <= 60 & 
                             vorwarnzeitaktuell > 14 ~ "#E49900",
                           vorwarnzeitaktuell < 14 ~ "#E40000")
        )
```

Row {data-height=175}
------------------------------------------------------------------------
\
**Legende:** \
***Reproduktionszahl R***: Anzahl der Personen, die eine infizierte Person durchschnittlich mit COVID-19 infiziert. \
<!-- *Neue Fälle pro Tag (7-Tages-Durchschnitt)*: Durchschnittliche Anzahl neuer Fälle pro Tag in den letzten 7 Meldetagen.\ -->
***Neue Fälle je 100.000 Einwohnende in 7 Tagen***: Auch als "7-Tage-Inzidenz" oder "Handlungsgrenze" bezeichnet.\
***Effektive Vorwarnzeit bei R=1,3***: Anzahl von Tagen bis zur Überschreitung von 25% der stationären Behandlungskapazitäten (Annahme 25% der Kapazität steht für COVID-19 zur Verfügung) ab heute (Annahme **Reaktionszeit von 21 Tagen bis Wirkung neuer Maßnahmen**), falls R=1,3 ab dem `r format(now(),format="%d.%m.%Y")`.



Row {data-height=400}
------------------------------------------------------------------------

### **Aktuelle Vorwarnzeiten**

```{r}
ggplotly(plot_Anstiegtheor  + labs(x="R(t)")) %>%
   config(displayModeBar = FALSE, responsive=T) %>%
layout(legend = list(x = 0.6, y = 0.9))
  
```

Row {data-height=110}
------------------------------------------------------------------------

Dargestellt ist die theoretische Vorwarnzeit bis zur Überschreitung der Kapazität an Intensivbetten abhängig von der Reproduktionszahl R, ausgehend von der durchschnittlichen aktuellen Zahl an Neuinfektionen in Deutschland. Die Neuinfektionen wurden über einen Zeitraum von 7 Tagen gemittelt, um Schwankungen auszugleichen. Die effektive Vorwarnzeit ist geringer als die theoretische Vorwarnzeit. Hier wird eine Reaktionszeit von 21 Tagen angenommen, bis ein R-Wert erkannt und Maßnahmen wirksam implementiert sind.



Row {data-height=400}
------------------------------------------------------------------------
### **Entwicklung der akut Infizierten**

```{r}

ggplotly(akutinfiziert + labs(title="")) %>%
   config(displayModeBar = FALSE, responsive=T)
```

Row {data-height=100}
------------------------------------------------------------------------

Dargestellt ist die Entwicklung der Anzahl von akut infizierten Personen in Deutschland. Angenommen wird, dass die Personen i.d.R. 15 Tage nach der gemeldeten Erkrankung nicht mehr akut infiziert sind. Die Zahl hatte am 6.4.2020 ihren bisherigen Höhepunkt von ca. 74 Tsd. Personen. 



Row {data-height=400}
------------------------------------------------------------------------
### **Entwicklung des Alters der Infizierten und des Anteils von Todesfällen**

```{r}
age_plot_fatality() %>%
   config(displayModeBar = FALSE, responsive=T)

```


Row {data-height=100}
------------------------------------------------------------------------

Dargestellt ist die Entwicklung des Anteils von neu gemeldeten akut infizierten Personen im Alter ab 60 Jahren an allen gemeldeten Fällen in Deutschland. Zudem wird der Anteil von Todesfällen an den gemeldeten Fällen dargestellt. Während beide Anteilswerte zu Beginn der Pandemie gleichlautend verlaufen sind, hat sich die Entwicklung zuletzt entkoppelt.


Row {data-height=400}
------------------------------------------------------------------------
### **Entwicklung der Reproduktionszahl**

```{r}
mitigationsplot_blvergleich() %>%
   config(displayModeBar = FALSE, responsive=T)

```

Row {data-height=100}
------------------------------------------------------------------------

Dargestellt ist die Entwicklung der Reproduktionszahl R auf Ebene der Bundesländer. Der Wert für den Bund ist blau dargestellt. R beschreibt die mittlere Anzahl von Neu-Infektionen, die von einer Person im Laufe ihrer COVID-19-Infektion angesteckt werden. R wird aus den Meldedaten des RKI geschätzt.


Row
-----------------------------------------------------------------------

### **Entwicklung der Vorwarnzeit (und Vergleich zum R-Wert des RKI)**

```{r}
vorwarnzeitverlauf_plot() %>%
   config(displayModeBar = FALSE, responsive=T)

```

Row {data-height=100}
------------------------------------------------------------------------

Dargestellt ist die Entwicklung der Zi-Vorwarnzeit für die BRD, ebenso zum Vergleich die Entwicklung des (7-Tage-)R-Wertes, wie er vom RKI gemeldet wird.

Row
-----------------------------------------------------------------------

### **Überblick zu den Kennzahlen der Bundesländer**

```{r}
DT::datatable(rki_fallzahl_bl(),
              extensions = 'Responsive',
              options = list(paging = FALSE,
                             searching = FALSE,
                             language = list(url = '//cdn.datatables.net/plug-ins/1.10.11/i18n/German.json'),
                             server = FALSE,
                             initComplete = JS("function(settings, json) {","$(this.api().table().header()).css({'background-color':'#0086C5','color': '#fff'});","}")))

```

Row {data-height=250}
------------------------------------------------------------------------
\
**Methodischer Hinweis zum R-Wert:** \
*In die Berechnung des R-Wertes gehen verschiedene Annahmen ein, da der Wert aufgrund unvollständiger Informationen zu Infektionsketten in der Regel geschätzt werden muss. Die Methodik des Zi und des RKI unterscheiden sich dabei in zwei zentralen Punkten. Das RKI betrachtet die neuen Erkrankten nach Erkrankungsdatum im Vergleich von zwei 4-Tages-Perioden und nimmt dadurch eine 4-tägige-Ansteckungsperiode an. Dabei müssen für etwa ein Drittel der Infizierten das Erkrankungsdatum geschätzt und Nachmeldungen durch das sog. Nowcasting interpoliert werden. Das Zi verwendet das Meldedatum als Infektionsbeginn und berücksichtigt eine längere Infektionsperiode, in der die meisten Ereignisse am 4. Tag auftreten, Ansteckungen aber auch später auftreten können (Gamma-Verteilung mit MW=4, SD=5). Beide Ansätze haben Vor- und Nachteile und zeigen langfristig die gleiche Tendenz an. Sowohl das Zi als auch das RKI schließen bei der Berechnung der R-Werte die Fallzahlen der letzten 4 Tage aus, da diese noch zu unverlässlich wegen Meldeverzügen sind.*

# Bundesländer

Row {data-height=100}
-----------------------------------------------------------------------

### **Überblick zum Verlauf des R-Wertes und der Vorwarnzeit in den Bundesländern**

Nachfolgend erhalten Sie einen Überblick zur allgemeinen historischen Situation der einzelnen Bundesländer. Einzelne Ausschläge des R-Wertes bedeuten noch keine kritische Situation, aber ein kontinuierlicher Rückgang der Vorwarnzeit ist als kritisch einzuschätzen. Fehlende Werte für die Vorwarnzeit ergeben sich aus 0 gemeldeten neuen Fällen im entsprechenden Bundesland.

Row {.tabset .tabset-fade}
-------------------------------------
   
### Schleswig-Holstein {#bl01}

```{r}
mitigationsplot_bl(1) %>%
   config(displayModeBar = FALSE, responsive=T)
```   
 
### Hamburg {#bl02}
    
```{r}
mitigationsplot_bl(2) %>%
   config(displayModeBar = FALSE, responsive=T)
```

### Niedersachsen {#bl03}

```{r}
mitigationsplot_bl(3) %>%
   config(displayModeBar = FALSE, responsive=T)
```   
 
### Bremen {#bl04}
    
```{r}
mitigationsplot_bl(4) %>%
   config(displayModeBar = FALSE, responsive=T)
```

### Nordrhein-Westfalen {#bl05}

```{r}
mitigationsplot_bl(5) %>%
   config(displayModeBar = FALSE, responsive=T)
```   
 
### Hessen {#bl06}
    
```{r}
mitigationsplot_bl(6) %>%
   config(displayModeBar = FALSE, responsive=T)
```

### Rheinland-Pfalz {#bl07}

```{r}
mitigationsplot_bl(7) %>%
   config(displayModeBar = FALSE, responsive=T)
```   
 
### Baden-Württemberg {#bl08}
    
```{r}
mitigationsplot_bl(8) %>%
   config(displayModeBar = FALSE, responsive=T)
```

### Bayern {#bl09}

```{r}
mitigationsplot_bl(9) %>%
   config(displayModeBar = FALSE, responsive=T)
```   
 
### Saarland {#bl10}
    
```{r}
mitigationsplot_bl(10) %>%
   config(displayModeBar = FALSE, responsive=T)
```

### Berlin {#bl11}

```{r}
mitigationsplot_bl(11) %>%
   config(displayModeBar = FALSE, responsive=T)
```   
 
### Brandenburg {#bl12}
    
```{r}
mitigationsplot_bl(12) %>%
   config(displayModeBar = FALSE, responsive=T)
```

### Mecklenburg-Vorpommern {#bl13}

```{r}
mitigationsplot_bl(13) %>%
   config(displayModeBar = FALSE, responsive=T)
```   
 
### Sachsen {#bl14}
    
```{r}
mitigationsplot_bl(14) %>%
   config(displayModeBar = FALSE, responsive=T)
```

### Sachsen-Anhalt {#bl15}

```{r}
mitigationsplot_bl(15) %>%
   config(displayModeBar = FALSE, responsive=T)
```   
 
### Thüringen {#bl16}
    
```{r}
mitigationsplot_bl(16) %>%
   config(displayModeBar = FALSE, responsive=T)
```

# Kreise

Row {data-height=100}
-----------------------------------------------------------------------

### **Überblick zu den Kennzahlen der Kreise**

Nachfolgend erhalten Sie einen Überblick zur Situation der einzelnen Kreise. Bitte beachten Sie, dass der Indikator Vorwarnzeit auf Ebene der Kreise und Städte nicht losgelöst von der Situation im jeweiligen Bundesland betrachtet werden sollte. Sofern die lokale Vorwarnzeit sehr gering ist, die Vorwarnzeit im Bundesland zugehörigen Bundesland aber vergleichsweise hoch ist, besteht unseres Erachtens noch keine kritische Situation.

Row
-----------------------------------------------------------------------


```{r}
DT::datatable(rki_fallzahl_kreis(),
              extensions = 'Responsive',
              options = list(paging = TRUE,
                             searching = TRUE,
                             language = list(url = '//cdn.datatables.net/plug-ins/1.10.11/i18n/German.json'),
                             server = FALSE,
                             initComplete = JS("function(settings, json) {","$(this.api().table().header()).css({'background-color':'#0086C5','color': '#fff'});","}")))

```


# Impressum

```{r include=FALSE}
# Datenexport Vorbereitung

frueindikatoren <- bind_cols("Indikator"=c("R-Wert",
                                           "Neue Fälle pro Tag",
                                           "Vorwarnzeit aktuell in Tagen",
                                           "Handlungsgrenze"),
                             "Wert"=c(format(indicatorR,digits = 2,decimal.mark = ","),
                                      faelleprotag,
                                      paste(vorwarnzeitaktuell,"Tage"),
                                      faelle7tage100kEW))

write_json(frueindikatoren,"data/frueindikatoren.json")
#write_json(rki_fallzahl_bl(),"data/bundeslaender.json")
#write_json(theoretisch,"data/vorwarnzeiten.json")
```


**Zentralinstitut für die kassenärztliche Versorgung in der Bundesrepublik Deutschland (Stiftung des bürgerlichen Rechts)**

Salzufer 8  
10587 Berlin  
Telefon: (030) 4005-2450  
Fax: (030) 4005-2490

E-Mail: [zi(at)zi.de](mailto:zi(at)zi.de)  
Internet: [www.zi.de](http://www.zi.de)

**Vertretung der Stiftung:**

Die Stiftung wird gerichtlich und außergerichtlich durch den Vorstand vertreten. Der Vorstand handelt durch seinen Vorsitzenden allein. Im Falle der Verhinderung des Vorsitzenden wird die Stiftung durch den Stellvertretenden Vorstandsvorsitzenden allein vertreten.

**Vorstandsvorsitzender:**

Dr. Dominik von Stillfried  

**Stellvertretender Vorstandsvorsitzender:**

Thomas Czihal

**Verantwortlicher für redaktionelle Inhalte:**

Dr. Dominik Graf von Stillfried

*USt-IdNr.: DE239451993*
  
Der Nutzung von im Rahmen der Impressumspflicht veröffentlichten Kontaktdaten durch Dritte zur Übersendung von nicht ausdrücklich angeforderter Werbung und Informationsmaterialien wird hiermit ausdrücklich widersprochen.

